# Component 3 - generate column.vector

- Purpose of this step - generate vector from column description

```text
- 1. Input/Output
- 2. Docker - Embedding
- 3. Folder Structure
- 4. Performance Consideration
```

## 1. Input / Output

### Input - Keys + JSON

```text
ClassifiedCompaniesRelational_Jul2025__ClassifiedCompaniesRelational__CompanyCategory
ClassifiedCompaniesRelational_Jul2025__ClassifiedCompaniesRelational__CompanyName
```

### Output

```json
{
  "ClassifiedCompaniesRelational_Jul2025__ClassifiedCompaniesRelational__CompanyName": {
    "column_name": "CompanyName",
    "data_type": "VARCHAR",
    "database_name": "ClassifiedCompaniesRelational_Jul2025",
    "null_percentage": 0.0,
    "sample_data": [
      "HOUSE OF MIAHS LIMITED",
      "KONSTNAR LIMITED",
      "B-SPOKE AUTOMOTIVE LIMITED",
      "CLARITY ULTRASOUND LIMITED",
      "FUNLINX UK LTD"
    ],
    "table_name": "ClassifiedCompaniesRelational",
    "total_rows": 10204100,
    "unique_count": 10026123,
    "description": "CompanyName - name of a registered company",
    // generated by Embedding Model
    "vector": [ 111 ]
  }
}
```

## 2. Docker - Embedding

Choose one - depending on acceptable quality

| Name   | Ports | Image                                | Type      | Dim | GPU |
|--------|-------|--------------------------------------|-----------|-----|-----|
| nomic  | 11435 | mingzilla/ollama-nomic-embed:1.0.2   | embedding | 768 | Y   |
| minilm | 30010 | mingzilla/api_all-minilm-l6-v2:1.0.1 | embedding | 384 | N   |

```yaml
services:
  ollama:
    image: mingzilla/ollama-nomic-embed:1.0.2
    container_name: schema-info-ollama-2025-08-v01
    ports:
      - "18011:11434"
    environment:
      - OLLAMA_HOST=0.0.0.0:11434
    restart: no
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:11434/" ]
      interval: 30s
      timeout: 10s
      retries: 3
```

## 3. Folder Structure - Supports Reusing Processed Data

```text
[data]       ------ Can Version Control
|-- 2025-07  ------ Previous
|   |-- keys.txt
|   +-- v3.json
|
+-- 2025-08  ------ Current
    |-- keys.txt
    +-- v3.json
```

## 4. Performance Consideration

## 4.1. Skip Embed Request

```text
key -> get json from `2025-07/v3.json` - json exists?
    - YES - Use -- It already has vectors 
    - NO  - EMB -> vectors 
```

## 4.2. Memory Strategy

- Small Count (e.g. < 1000 columns) - in memory processing -> dump into a file
- IO once - file handling, synchronization
